# Serverless

サーバレスって？

AWSメインのメモ。

## 現状理解
- サーバを使わないシステム
  - リクエスト数や負荷に対する考慮(=管理)の煩わしさから解放される
- Lambdaを活用したアーキ
  - API Gateway→Lambda→RDSやS3的な構成？

## 疑問

1. で、結局サーバレスとは？
1. 構成例はどのようなものがあるか？
1. 使える言語等は？
1. サーバの管理から解放されるとは？
1. メリデメは？
1. 認証機能、セッション機能は実現できるのか？

---

### Q1. サーバレスとは？
AWSのLambdaやGoogleのCloud Functionsで関数を定義してクラウド上で実行するもの。
処理に必要なリソースはサービス側が管理してくれるため、関数を管理したサービスという意味で「**Function as a Service（Faas）**」とも呼ばれる。（広義/狭義で色々あるっぽい。）

#### 生まれた背景

アプリケーションの提供には、プログラムとその実行環境のサーバが必要であり、当然ながら構築やメンテナンスをする必要もあったが、サーバのスペック以上のリクエストが集中して、実行環境がクラッシュしてしまう可能性があった。
そのため従来の環境では、CPUやメモリなどをカスタマイズする必要があった。

その労力からの解放を目的として、関数でシステムを構築することにより、サーバのプロビジョニング管理をする必要がなくすことができる。

[サーバレスって何が便利なの？](https://aws.amazon.com/jp/builders-flash/202003/awsgeek-serverless/)

---

### Q2. 構成例はどのようなものがあるか？

[形で考えるサーバーレス設計](https://aws.amazon.com/jp/serverless/patterns/serverless-pattern/)

メモ：  
Web関連では、「動的Web」「業務系API」「分散並列処理」あたりが参考になりそう。

---

### Q3. 使える言語等は？

[AWS Lambdaよくある質問](https://aws.amazon.com/jp/lambda/faqs/#:~:text=AWS%20Lambda%20%E3%81%AF%E3%80%81%E3%83%8D%E3%82%A4%E3%83%86%E3%82%A3%E3%83%96%E3%81%A7%E3%81%AF,%E3%82%92%E6%8F%90%E4%BE%9B%E3%81%97%E3%81%A6%E3%81%84%E3%81%BE%E3%81%99%E3%80%82)

> AWS Lambda は、ネイティブでは、Java、Go、PowerShell、Node.js、C#、Python、Ruby のコードをサポートしています。

[Azure Functions でサポートされている言語](https://docs.microsoft.com/ja-jp/azure/azure-functions/supported-languages)

> C#, JavaScript, F#, Java, PowerShell, Python, TypeScript

[Cloud Functions 実行環境](https://cloud.google.com/functions/docs/concepts/exec?hl=ja)

> Node.js, Python, Go, Java

---

### Q4. サーバの管理から解放されるとは？

[AWS Lambdaとは](https://docs.aws.amazon.com/ja_jp/lambda/latest/dg/welcome.html)

> AWS Lambda はサーバーをプロビジョニングしたり管理する必要なくコードを実行できるコンピューティングサービスです。 AWS Lambda は必要時にのみてコードを実行し、1 日あたり数個のリクエストから 1 秒あたり数千のリクエストまで自動的にスケーリングします。

> AWS Lambda の使用では、お客様は自身のコードのみに責任を負います。

OSやネットワーク、セキュリティ設定、CPU、メモリなどをAWSがよしなに管理をしてくれる。**自由度とのトレードオフ** で、独自の管理をしたい場合はEC2等の使用を選択肢に入れるべき。

> 独自のコンピューティングリソースを管理する必要がある場合は、Amazon Web Services は目的に適した他のコンピューティングサービスも提供します。

---

### Q5. メリデメは？

[サーバーレスの理解とメリット・デメリット（2020年版）](https://qiita.com/takanorig/items/3a3a0b43b5be5b4a124f)

- メリット
  - ビジネス
    - 利用した分だけの課金となり、多くの場合、ランニングコストの低減につながる。
    - ビジネス発展／競争力向上に向けたITシステムのアジリティを向上させやすくなる。
    - コスト面／開発スピードを踏まえて、新サービスのチャレンジをしやすい。
  - 開発
    - ビジネスロジックに集中して開発できる。
    - 自動でスケールされため、冗長化の考慮／対応などは最小限で済む。
    - 非同期／ステートレスな構成で、疎結合な開発を行いやすい。
    - マイクロサービスを実現しやすい。
  - 運用
    - サーバーの構築やパッチ適用など、構築・運用にかかる手間が不要となる。
    - サーバーダウンによる障害対応などが軽減される。
- デメリット
  - ビジネス
    - ベンダーロックインとなり、一度開発したモノを他クラウドベンダーへ移行するのは困難である。
    - サーバーレス・アーキテクチャで適切に開発／構築できるエンジニアは少なく、人材確保が難しい。
  - 開発
    - ベンダーロックインとなり、クラウドベンダーが異なれば、機能性や実装方法も大きく異なる（実行時間やデプロイサイズなどに制限がある）。
    - アプリケーションのデバッグは難しくなる。
    - 低レイテンシを求められる機能には向かない。
  - 運用
    - 複数のサービスが関連して動作するため、一般的なアプリケーションよりもモニタリングなどは複雑になる。
    - ランタイムの大部分がクラウド内部に隠蔽されているため、問題解析が難しくなる。
    - クラウドインフラの障害に大きく影響される。

---

### Q6. 認証機能、セッション機能は実現できるのか？

[マイクロサービス時代のセッション管理](https://engineer.retty.me/entry/2019/12/21/171549)

[多分わかりやすいサーバーレスアーキテクチャ入門その2](https://tech-lab.sios.jp/archives/11110)

---

## 用語

### プロビジョニング
必要に応じてネットワークやコンピュータの設備などのリソースを提供できるよう予測して準備しておくこと

### SPOF
システム上のあるコンポーネントが異常を来たすと、そのシステム全体が障害に陥ってしまうようなコンポーネントの総称

### JSON Web Token（JWT）
JSON Web Token（ジェイソン・ウェブ・トークン）は、JSONデータに署名や暗号化を施す方法を定めたオープン標準 (RFC 7519)

---

## 所感

メリデメにあげられている通りだが、  
- サービス側でインフラ面をよしなにスケールしてくれ、その上コストダウンが見込めるのは嬉しい。
- 反面、自由度の低さをどこまで許容できるかが気になった。
    - ベンダーへの依存
    - 言語の縛り
    - ステートレスなどの考え方　など

内部処理を定期的に実行するパターンや一方向の処理に向いていそうな印象。従来のWebの構成や考え方とは違うし、セッションの管理が一筋縄でできなそうなため。  

開発時に関しても、手元で立ち上げて再現してみよう、のイメージがいまだにできていない。